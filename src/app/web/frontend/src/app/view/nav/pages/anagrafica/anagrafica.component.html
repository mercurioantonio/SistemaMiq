<div>
<nz-input-group class="anagrafica_input_group" nzSearch nzSize="large" [nzAddOnAfter]="suffixButton">
    <input class="input_cod_miq" type="text" nz-input [(ngModel)]="inputString" (ngModelChange)="modelChanged($event)" placeholder="Cerca il tuo codice MIQ" (keyup.enter)="inviaDati()" oninput="this.value = this.value.toUpperCase()" maxlength="7" />
  </nz-input-group>
  <ng-template  #suffixButton>
    <button class="anagrafica_search" (click)="inviaDati()" nz-button nzType="primary" nzSize="large" nzSearch >Cerca</button>
  </ng-template>
</div>

  <div class="anagrafica" *ngIf="status == 'success' && dataframeData.image">
    <nz-descriptions class="description_title" nzTitle="Anagrafica MIQ" nzBordered *ngIf="dataframeData">
      <nz-descriptions-item nzTitle="Denominazione strumento" [nzSpan]="2">{{dataframeData.denominazione_strumento}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Scheda di controllo MIQ">{{dataframeData.scm}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Classe">{{dataframeData.classe}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Reparto">{{dataframeData.reparto}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Localizzazione">{{dataframeData.localizzazione}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="TUR">{{dataframeData.tur}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Campo di misura">{{dataframeData.campo_di_misura}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Risoluzione">{{dataframeData.risoluzione}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Incertezza">{{dataframeData.incertezza}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Campione di riferimento" [nzSpan]="2"><a (click)="campione(dataframeData.campione_di_riferimento)">{{dataframeData.campione_di_riferimento}}</a></nz-descriptions-item>
      <nz-descriptions-item nzTitle="Frequenza di taratura">{{dataframeData.intervallo_di_taratura}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Grandezza misurata">{{dataframeData.grandezza_misurata}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Unità di misura">{{dataframeData.unita_di_misura}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Casa costruttrice">{{dataframeData.casa_costruttrice}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Modello">{{dataframeData.modello}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Taratura">{{dataframeData.taratura}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Addetto taratura" [nzSpan]="1.5">{{dataframeData.addetto_taratura}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Matricola" [nzSpan]="1.5">{{dataframeData.matricola}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Immagine MIQ" >
        <img nz-image width="400px" height="400px" src="data:image/jpeg;base64,{{dataframeData.image}}" alt="" >
      </nz-descriptions-item>
    </nz-descriptions>
    <div *ngIf="status_chart">
      <button nz-button class="graph" nzType="primary" (click)="graph(dataframeData.scm)" nzSize="large" nzSearch >Estrai grafico</button>
    </div>
    <div nz-row *ngIf="status_chart">
      <div style="height:150%" style="width: 30%;">
          <canvas id='myChart' height="800" width="400"> </canvas>
      </div>
      <div style="height:150%" style="width: 30%;">
        <canvas id='myChart2' height="800" width="400"> </canvas>
      </div>
      <div style="height:150%" style="width: 30%;">
        <canvas id='myChart3' height="800" width="400"> </canvas>
      </div>
      <div style="height:150%" style="width: 30%;">
        <canvas id='myChart4' height="800" width="400"> </canvas>
      </div>
      <div style="height:150%" style="width: 30%;">
        <canvas id='myChart5' height="800" width="400"> </canvas>
      </div>
      <div style="height:150%" style="width: 30%;">
        <canvas id='myChart6' height="800" width="400"> </canvas>
      </div>
    </div>
  </div>



  <div class="anagrafica" *ngIf="status == 'success' && !dataframeData.image">
    <nz-descriptions class="description_title" nzTitle="Anagrafica MIQ" nzBordered *ngIf="dataframeData">
      <nz-descriptions-item nzTitle="Denominazione strumento" [nzSpan]="2">{{dataframeData.denominazione_strumento}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Scheda di controllo MIQ">{{dataframeData.scm}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Classe">{{dataframeData.classe}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Reparto">{{dataframeData.reparto}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Localizzazione">{{dataframeData.localizzazione}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="TUR">{{dataframeData.tur}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Campo di misura">{{dataframeData.campo_di_misura}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Risoluzione">{{dataframeData.risoluzione}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Incertezza">{{dataframeData.incertezza}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Campione di riferimento" [nzSpan]="2"><a (click)="campione(dataframeData.campione_di_riferimento)">{{dataframeData.campione_di_riferimento}}</a></nz-descriptions-item>
      <nz-descriptions-item nzTitle="Frequenza di taratura">{{dataframeData.intervallo_di_taratura}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Grandezza misurata">{{dataframeData.grandezza_misurata}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Unità di misura">{{dataframeData.unita_di_misura}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Casa costruttrice">{{dataframeData.casa_costruttrice}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Modello">{{dataframeData.modello}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Taratura">{{dataframeData.taratura}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Addetto taratura" [nzSpan]="1.5">{{dataframeData.addetto_taratura}}</nz-descriptions-item>
      <nz-descriptions-item nzTitle="Matricola" [nzSpan]="1.5">{{dataframeData.matricola}}</nz-descriptions-item>
    </nz-descriptions>
    <div *ngIf="status_chart">
      <button nz-button class="graph" nzType="primary" (click)="graph(dataframeData.scm)" nzSize="large" nzSearch >Estrai grafico</button>
    </div>
    <div nz-row *ngIf="status_chart">
      <div style="height:150%" style="width: 30%;">
          <canvas id='myChart' height="800" width="400"> </canvas>
      </div>
      <div style="height:150%" style="width: 30%;">
        <canvas id='myChart2' height="800" width="400"> </canvas>
      </div>
      <div style="height:150%" style="width: 30%;">
        <canvas id='myChart3' height="800" width="400"> </canvas>
      </div>
      <div style="height:150%" style="width: 30%;">
        <canvas id='myChart4' height="800" width="400"> </canvas>
      </div>
      <div style="height:150%" style="width: 30%;">
        <canvas id='myChart5' height="800" width="400"> </canvas>
      </div>
      <div style="height:150%" style="width: 30%;">
        <canvas id='myChart6' height="800" width="400"> </canvas>
      </div>
    </div>
  </div>

  <div *ngIf="tabella11">
    <button nz-button class="graph" nzType="primary" (click)="graph(dataframeData.scm)" nzSize="large" nzSearch >Estrai grafico</button>
  </div>
  <br>
  <br>
  <nz-table #basicTable class="tabella11" [nzData]="tar" *ngIf="tabella11" [nzFrontPagination]="false">
    <thead>
      <tr>
        <th nzWidth="100px">Data</th>
        <th nzWidth="100px">Integrità</th>
        <th nzWidth="100px">Conformità</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let data of basicTable.data">
        <td>{{data.data | date:'dd-MM-yyyy'}}</td>
        <td>{{data.y_integrita}}</td>
        <td>{{data.y_conformita}}</td>
      </tr>
    </tbody>
  </nz-table>

  <nz-modal *ngIf="status_campione" [(nzVisible)]="status_campione" [nzTitle]="modalTitle"   [nzContent]="modalContent" [nzFooter]="modalFooter" (nzOnCancel)="handleOkCampione()" (nzOnCancel)="handleOkCampione()" [nzWidth]="1000" [nzCentered]="true" [nzMaskClosable]="true">
    <ng-template #modalTitle>Campione di riferimento</ng-template>
    <ng-template #modalContent>
      <nz-descriptions class="description_title" nzTitle="{{dataframeCampione[0].cod_miq}}" nzBordered *ngIf="dataframeCampione[0]">
        <nz-descriptions-item nzTitle="N° certificato" [nzSpan]="3">{{dataframeCampione[0].n_cert}}</nz-descriptions-item>
        <nz-descriptions-item nzTitle="Scadenza" [nzSpan]="1">{{dataframeCampione[0].scadenza | date:'dd-MM-yyyy'}}</nz-descriptions-item>
        <nz-descriptions-item nzTitle="Settimana scadenza" [nzSpan]="1">{{dataframeCampione[0].settimana_scadenza}}</nz-descriptions-item>
        <nz-descriptions-item nzTitle="Anno scadenza" [nzSpan]="1">{{dataframeCampione[0].anno_scadenza}}</nz-descriptions-item>
      </nz-descriptions>
      <br>
      <nz-descriptions class="description_title" nzTitle="{{dataframeCampione[1].cod_miq}}" nzBordered *ngIf="dataframeCampione[1]">
        <nz-descriptions-item nzTitle="N° certificato" [nzSpan]="3">{{dataframeCampione[1].n_cert}}</nz-descriptions-item>
        <nz-descriptions-item nzTitle="Scadenza" [nzSpan]="1">{{dataframeCampione[1].scadenza | date:'dd-MM-yyyy'}}</nz-descriptions-item>
        <nz-descriptions-item nzTitle="Settimana scadenza" [nzSpan]="1">{{dataframeCampione[1].settimana_scadenza}}</nz-descriptions-item>
        <nz-descriptions-item nzTitle="Anno scadenza" [nzSpan]="1">{{dataframeCampione[1].anno_scadenza}}</nz-descriptions-item>
      </nz-descriptions>
      <br>
      <nz-descriptions class="description_title" nzTitle="{{dataframeCampione[2].cod_miq}}" nzBordered *ngIf="dataframeCampione[2]">
        <nz-descriptions-item nzTitle="N° certificato" [nzSpan]="3">{{dataframeCampione[2].n_cert}}</nz-descriptions-item>
        <nz-descriptions-item nzTitle="Scadenza" [nzSpan]="1">{{dataframeCampione[2].scadenza | date:'dd-MM-yyyy'}}</nz-descriptions-item>
        <nz-descriptions-item nzTitle="Settimana scadenza" [nzSpan]="1">{{dataframeCampione[2].settimana_scadenza}}</nz-descriptions-item>
        <nz-descriptions-item nzTitle="Anno scadenza" [nzSpan]="1">{{dataframeCampione[2].anno_scadenza}}</nz-descriptions-item>
      </nz-descriptions>
      <br>
      <nz-descriptions class="description_title" nzTitle="{{dataframeCampione[3].cod_miq}}" nzBordered *ngIf="dataframeCampione[3]">
        <nz-descriptions-item nzTitle="N° certificato" [nzSpan]="3">{{dataframeCampione[3].n_cert}}</nz-descriptions-item>
        <nz-descriptions-item nzTitle="Scadenza" [nzSpan]="1">{{dataframeCampione[3].scadenza | date:'dd-MM-yyyy'}}</nz-descriptions-item>
        <nz-descriptions-item nzTitle="Settimana scadenza" [nzSpan]="1">{{dataframeCampione[3].settimana_scadenza}}</nz-descriptions-item>
        <nz-descriptions-item nzTitle="Anno scadenza" [nzSpan]="1">{{dataframeCampione[3].anno_scadenza}}</nz-descriptions-item>
      </nz-descriptions>
      <br>
      <nz-descriptions class="description_title" nzTitle="{{dataframeCampione[4].cod_miq}}" nzBordered *ngIf="dataframeCampione[4]">
        <nz-descriptions-item nzTitle="N° certificato" [nzSpan]="3">{{dataframeCampione[4].n_cert}}</nz-descriptions-item>
        <nz-descriptions-item nzTitle="Scadenza" [nzSpan]="1">{{dataframeCampione[4].scadenza | date:'dd-MM-yyyy'}}</nz-descriptions-item>
        <nz-descriptions-item nzTitle="Settimana scadenza" [nzSpan]="1">{{dataframeCampione[4].settimana_scadenza}}</nz-descriptions-item>
        <nz-descriptions-item nzTitle="Anno scadenza" [nzSpan]="1">{{dataframeCampione[4].anno_scadenza}}</nz-descriptions-item>
      </nz-descriptions>
    </ng-template>
    <ng-template #modalFooter>
        <button nz-button nzType="primary" (click)="handleOkCampione()">Chiudi</button>
    </ng-template>
  </nz-modal>
  

  <div *ngIf="status == 'failed'">
    <nz-alert
    nzType="error"
    nzMessage="Errore"
    nzDescription="Nessuno strumento di misurazione corrispondente"
    nzShowIcon
  ></nz-alert>
  </div>